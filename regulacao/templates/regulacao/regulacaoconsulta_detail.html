{% extends 'base.html' %}

{% block title %}Detalhe da Consulta #{{ regulacao.numero_protocolo }}{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">
      <i class="bi bi-clipboard2-pulse text-primary"></i>
      Solicitação de Consulta — Protocolo #{{ regulacao.numero_protocolo }}
    </h4>
    <div class="d-print-none">
      <a class="btn btn-outline-secondary" href="{% url 'consulta-list' %}">
        <i class="bi bi-arrow-left"></i> Voltar
      </a>
      {% if (regulacao.status == 'fila' or regulacao.status == 'pendente') and not is_ubs_user %}
      <a class="btn btn-warning" href="{% url 'regular-consulta' regulacao.pk %}">
        <i class="bi bi-gear-fill"></i> Regular
      </a>
      {% endif %}
      {% if regulacao.status == 'autorizado' %}
      <a class="btn btn-primary" href="{% url 'impressao-consulta' regulacao.pk %}" target="_blank">
        <i class="bi bi-printer"></i> Imprimir
      </a>
      {% endif %}
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <div class="row g-4">
        <div class="col-md-6">
          <h6 class="text-muted">Paciente</h6>
          <p class="mb-1"><strong>Nome:</strong> {{ regulacao.paciente.nome }}</p>
          {% if regulacao.paciente.cpf %}
          <p class="mb-1"><strong>CPF:</strong> {{ regulacao.paciente.cpf }}</p>
          {% endif %}
          {% if regulacao.paciente.cns %}
          <p class="mb-0"><strong>CNS:</strong> {{ regulacao.paciente.cns }}</p>
          {% endif %}
        </div>
        <div class="col-md-6">
          <h6 class="text-muted">Solicitação</h6>
          <p class="mb-1"><strong>Especialidade:</strong> {{ regulacao.especialidade.nome }}</p>
          <p class="mb-1"><strong>UBS Solicitante:</strong> {{ regulacao.ubs_solicitante.nome }}</p>
          <p class="mb-1"><strong>Médico Solicitante:</strong> {{ regulacao.medico_solicitante.nome }} (CRM {{ regulacao.medico_solicitante.crm }})</p>
          <p class="mb-0"><strong>Data Solicitação:</strong> {{ regulacao.data_solicitacao|date:'d/m/Y H:i' }}</p>
        </div>
      </div>

      <hr>
      <div class="row g-4">
        <div class="col-md-6">
          <h6 class="text-muted">Status</h6>
          <p class="mb-1">
            <span class="badge {{ regulacao.get_status_badge_class }}">{{ regulacao.get_status_display }}</span>
          </p>
          {% if regulacao.regulador or regulacao.data_regulacao %}
          <p class="mb-1"><strong>Regulado por:</strong> {% if regulacao.regulador %}{% firstof regulacao.regulador.get_full_name regulacao.regulador.username %}{% else %}-{% endif %}</p>
          <p class="mb-0"><strong>Data Regulação:</strong> {{ regulacao.data_regulacao|date:'d/m/Y H:i' }}</p>
          {% endif %}
        </div>
        <div class="col-md-6">
          <h6 class="text-muted">Prioridade</h6>
          <p class="mb-0">{{ regulacao.get_prioridade_display }}</p>
        </div>
      </div>

      <hr>
      <div class="row g-4">
        <div class="col-md-6">
          <h6 class="text-muted">Justificativa Clínica</h6>
          <p class="mb-0">{{ regulacao.justificativa|default:'—' }}</p>
        </div>
        <div class="col-md-6">
          <h6 class="text-muted">Observações da Solicitação</h6>
          <p class="mb-0">{{ regulacao.observacoes_solicitacao|default:'—' }}</p>
        </div>
      </div>

      {% if regulacao.status == 'autorizado' %}
      <hr>
      <div class="row g-4">
        <div class="col-md-6">
          <h6 class="text-muted">Agendamento</h6>
          <p class="mb-1"><strong>Local:</strong> {{ regulacao.local_atendimento|default:'—' }}</p>
          <p class="mb-1"><strong>Data:</strong> {{ regulacao.data_agendada|date:'d/m/Y' }}</p>
          <p class="mb-0"><strong>Hora:</strong> {{ regulacao.hora_agendada|time:'H:i' }}</p>
        </div>
        <div class="col-md-6">
          <h6 class="text-muted">Médico Atendente</h6>
          <p class="mb-0">{% if regulacao.medico_atendente %}{{ regulacao.medico_atendente.nome }} (CRM {{ regulacao.medico_atendente.crm }}){% else %}—{% endif %}</p>
        </div>
      </div>
      <div class="mt-3">
        <h6 class="text-muted">Observações da Regulação</h6>
        <p class="mb-0">{{ regulacao.observacoes_regulacao|default:'—' }}</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>
 
{% endblock %}
