<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Impressão • Exames do Dia</title>
  <style>
    :root { --primary: #0d6efd; --ink: #111; --muted: #555; --line: #d9dde1; }
    html, body { height: 100%; }
    body { font-family: Arial, Helvetica, sans-serif; font-size: 12pt; color: var(--ink); }
    .container { max-width: 1024px; margin: 0 auto; padding: 16px; }
    .header { display: flex; align-items: center; justify-content: space-between; border-bottom: 2px solid var(--line); padding-bottom: 10px; margin-bottom: 12px; }
    .brand { font-weight: 700; font-size: 12pt; color: var(--primary); }
    .doc-title { font-size: 18pt; font-weight: 700; margin: 0; }
    .actions { text-align: right; margin-bottom: 10px; }
    .btn { padding: 6px 10px; border: 1px solid var(--line); background: #fff; border-radius: 6px; cursor: pointer; }
    .btn:hover { background: #f5f7fa; }
    .muted { color: var(--muted); }
    .small { font-size: 10pt; }
    .muted { color: #666; }
    .meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px 20px; margin: 8px 0 14px; }
    .meta-grid div { line-height: 1.4; }
    .badge { display: inline-block; padding: 2px 8px; border: 1px solid var(--line); border-radius: 999px; font-size: 10pt; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    thead th { text-align: left; padding: 8px; background: #f2f5f9; border-bottom: 2px solid var(--line); font-weight: 600; }
    tbody td { padding: 8px; border-bottom: 1px solid var(--line); vertical-align: top; }
    tbody tr:last-child td { border-bottom: 0; }
    .wrap { white-space: normal; }
    .nowrap { white-space: nowrap; }
    .table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .section-title { margin: 12px 0 6px; font-size: 14pt; font-weight: 700; }
    .footer { margin-top: 16px; padding-top: 8px; border-top: 1px solid var(--line); display: flex; justify-content: space-between; gap: 10px; }
    .right { text-align: right; }
    @media (max-width: 640px) { .meta-grid { grid-template-columns: 1fr; } .doc-title { font-size: 16pt; } .brand { font-size: 11pt; } }
    @media print { .no-print, .actions { display: none !important; } body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } @page { size: A4; margin: 12mm; } .container { padding: 0; } a { color: inherit; text-decoration: none; } .table-wrapper { overflow: visible; } tr { page-break-inside: avoid; } }
  </style>
  <script>
    window.addEventListener('load', function(){
      setTimeout(function(){ window.print(); }, 300);
    });
  </script>
</head>
<body>
  <div class="container">
    <div class="actions no-print">
      <button class="btn" onclick="window.print()">Imprimir</button>
    </div>
    <div class="header">
      <div class="brand">Secretaria Municipal de Saúde • Iturama - MG</div>
      <h1 class="doc-title">Exames do Dia</h1>
    </div>

    <div class="meta-grid">
      <div><strong>Paciente:</strong> {{ paciente.nome }}</div>
      <div><strong>CPF:</strong> {{ paciente.cpf }}</div>
      <div><strong>CNS:</strong> {{ paciente.cns|default:"-" }}</div>
      <div><strong>Data selecionada:</strong> <span class="badge">{{ data|date:"d/m/Y" }}</span></div>
    </div>

    <div class="section-title">Exames</div>
    {% if exames %}
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th style="width: 30%;">Exame</th>
              <th style="width: 18%;">UBS Solicitante</th>
              <th style="width: 18%;">Local</th>
              <th style="width: 12%;" class="nowrap">Data</th>
              <th style="width: 10%;" class="nowrap">Hora</th>
              <th style="width: 12%;">Autorização</th>
            </tr>
          </thead>
          <tbody>
            {% for item in exames %}
              <tr>
                <td class="wrap">
                  <div><strong>{{ item.tipo_exame.nome|default:item.tipo_exame }}</strong></div>
                  {% if item.observacoes_regulacao %}<div class="small muted">Obs.: {{ item.observacoes_regulacao }}</div>{% endif %}
                  {% if item.observacoes_solicitacao %}<div class="small muted">Obs. (UBS): {{ item.observacoes_solicitacao }}</div>{% endif %}
                </td>
                <td class="wrap">{{ item.ubs_solicitante.nome|default:item.ubs_solicitante }}</td>
                <td class="wrap">
                  {% if item.local_atendimento_obj %}
                    <div><strong>{{ item.local_atendimento_obj.nome }}</strong></div>
                    {% if item.local_atendimento_obj.endereco %}
                      <div class="small muted">{{ item.local_atendimento_obj.endereco }}</div>
                    {% endif %}
                    {% if item.local_atendimento_obj.telefone %}
                      <div class="small muted">Tel: {{ item.local_atendimento_obj.telefone }}</div>
                    {% endif %}
                  {% else %}
                    {{ item.local_realizacao|default:"-" }}
                  {% endif %}
                </td>
                <td class="nowrap">{{ item.data_agendada|date:"d/m/Y" }}</td>
                <td class="nowrap">{{ item.hora_agendada|time:"H:i" }}</td>
                <td class="small wrap">
                  <div>por {{ item.regulador.get_full_name|default:item.regulador }}</div>
                  <div>em {{ item.data_regulacao|date:"d/m/Y H:i" }}</div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="muted">Nenhum exame encontrado para a data informada.</p>
    {% endif %}

    <div class="footer small muted">
      <div>Sistema de Regulação • Prefeitura de Iturama</div>
      <div class="right">Impresso em {% now "d/m/Y H:i" %}</div>
    </div>
  </div>
</body>
</html>
