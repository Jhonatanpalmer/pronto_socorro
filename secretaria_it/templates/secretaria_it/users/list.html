{% extends 'base.html' %}
{% block title %}Usuários{% endblock %}
{% block content %}
<div class="container py-3 py-md-4">
  <!-- Hero + Ações -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-3">
    <div>
      <h2 class="mb-0">Usuários</h2>
      <div class="text-muted">Gerencie contas e permissões</div>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary" href="{% url 'groups-list' %}"><i class="bi bi-people"></i> Grupos</a>
      <a class="btn btn-primary" href="{% url 'user-create' %}"><i class="bi bi-person-plus"></i> Novo Usuário</a>
    </div>
  </div>

  <!-- Tabela responsiva -->
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Username</th>
          <th>Nome</th>
          <th>E-mail</th>
          <th>UBS</th>
          <th>Ativo</th>
          <th>Staff</th>
          <th>Superuser</th>
          <th>Grupos</th>
          <th class="text-end">Ações</th>
        </tr>
      </thead>
      <tbody>
      {% for u in users %}
        <tr>
          <td class="fw-semibold">{{ u.username }}</td>
          <td>{{ u.get_full_name }}</td>
          <td>{{ u.email }}</td>
          <td>{% if u.perfil_ubs and u.perfil_ubs.ubs %}{{ u.perfil_ubs.ubs.nome }}{% else %}-{% endif %}</td>
          <td>{% if u.is_active %}<span class="badge bg-success">Sim</span>{% else %}<span class="badge bg-secondary">Não</span>{% endif %}</td>
          <td>{% if u.is_staff %}<span class="badge bg-info text-dark">Sim</span>{% else %}<span class="badge bg-secondary">Não</span>{% endif %}</td>
          <td>{% if u.is_superuser %}<span class="badge bg-warning text-dark">Sim</span>{% else %}<span class="badge bg-secondary">Não</span>{% endif %}</td>
          <td>{% for g in u.groups.all %}<span class="badge bg-secondary me-1">{{ g.name }}</span>{% empty %}-{% endfor %}</td>
          <td class="text-end">
            <div class="btn-group btn-group-sm" role="group">
              <a class="btn btn-outline-primary" href="{% url 'user-update' u.pk %}"><i class="bi bi-pencil-square"></i></a>
              <a class="btn btn-outline-danger" href="{% url 'user-delete' u.pk %}"><i class="bi bi-trash"></i></a>
            </div>
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="9" class="text-center text-muted">Sem usuários.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
